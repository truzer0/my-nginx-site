<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Достижения</title>
    <link rel="icon" href="data:image/jpeg;base64,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" type="image/jpeg">
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-hover: #3a56d4;
            --dark-bg: #2a2a2a;
            --darker-bg: #1e1e1e;
            --card-bg: #333333;
            --text-color: #f0f0f0;
            --light-gray: #444444;
            --border-color: #555555;
            --error-color: #ff3333;
            --success-color: #28a745;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: var(--dark-bg);
            margin: 0;
            padding: 0;
            color: var(--text-color);
        }

        /* Хедер */
        header {
            background-color: var(--darker-bg);
            color: var(--text-color);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Логотип и навигация слева */
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        header h1 {
            margin: 0;
            font-size: 22px;
            cursor: pointer;
            position: relative;
        }

        /* Выпадающее меню для достижений */
        .achievements-dropdown {
            display: none;
            position: absolute;
            background-color: var(--darker-bg);
            min-width: 200px;
            box-shadow: var(--box-shadow);
            z-index: 1;
            border-radius: var(--border-radius);
            padding: 10px 0;
            margin-top: 5px;
        }

        header h1:hover .achievements-dropdown {
            display: block;
        }

        .achievements-dropdown a {
            color: var(--text-color);
            padding: 10px 15px;
            text-decoration: none;
            display: block;
            transition: var(--transition);
        }

        .achievements-dropdown a:hover {
            background-color: var(--light-gray);
        }

        nav {
            display: flex;
            gap: 15px;
        }

        .nav-button {
            background-color: var(--light-gray);
            color: var(--text-color);
            padding: 8px 15px;
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .nav-button:hover {
            background-color: var(--primary-color);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .user-menu:hover {
            background-color: var(--light-gray);
        }

        .user-avatar-container {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid var(--primary-color);
            flex-shrink: 0;
        }

        .user-avatar {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .user-avatar:hover {
            opacity: 0.8;
        }

        .user-name {
            font-weight: bold;
            white-space: nowrap;
        }

        .user-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--darker-bg);
            min-width: 160px;
            box-shadow: var(--box-shadow);
            z-index: 100;
            border-radius: var(--border-radius);
            padding: 10px 0;
            margin-top: 5px;
        }

        .user-menu:hover .user-dropdown {
            display: block;
        }

        .user-dropdown button {
            width: 100%;
            text-align: left;
            padding: 10px 15px;
            border: none;
            background: none;
            color: var(--text-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .user-dropdown button:hover {
            background-color: var(--light-gray);
        }

        /* Основной контент */
        main {
            padding: 20px;
        }

        /* Контейнер для доступных достижений */
        .links-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        /* Карточка достижения */
        .achievement {
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: calc(33% - 30px);
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: var(--transition);
        }

        .achievement:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }

        .achievement strong {
            font-size: 16px;
            margin-bottom: 10px;
            text-align: center;
        }

        .achievement button {
            margin-top: 10px;
            padding: 8px 12px;
            border: none;
            border-radius: var(--border-radius);
            background-color: var(--primary-color);
            color: var(--text-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .achievement button:hover {
            background-color: var(--primary-hover);
        }

        /* Стили для мессенджера */
        #messengerModal {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 400px;
            max-height: 600px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            z-index: 1000;
            flex-direction: column;
        }

        #openMessengerButton {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            z-index: 999;
        }

        #conversationsList, #messagesContainer, #usersList {
            overflow-y: auto;
            flex-grow: 1;
        }

        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 15px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .my-message {
            background-color: var(--primary-color);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 0;
        }

        .their-message {
            background-color: var(--darker-bg);
            margin-right: auto;
            border-bottom-left-radius: 0;
        }

        .message-time {
            font-size: 11px;
            text-align: right;
            color: rgba(255,255,255,0.7);
            margin-top: 5px;
        }

        .author-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        #showUsersButton {
            transition: var(--transition);
        }

        #showUsersButton:hover {
            background-color: var(--primary-hover) !important;
        }

        /* Адаптивность */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .header-left, .header-right {
                width: 100%;
                justify-content: space-between;
            }
            
            .achievement {
                width: calc(50% - 15px);
            }
        }

        @media (max-width: 480px) {
            .achievement {
                width: 100%;
            }
            
            nav {
                flex-wrap: wrap;
            }

            /* Адаптивность для мессенджера */
            #messengerModal {
                width: 100%;
                bottom: 0;
                right: 0;
                border-radius: 0;
                max-height: 80vh;
            }
            
            #openMessengerButton {
                bottom: 10px;
                right: 10px;
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body>

<header>
    <div class="header-left">
        <h1>Достижения
            <div class="achievements-dropdown">
                <a href="#">Все достижения</a>
                <a href="#">Доступные</a>
                <a href="#">Полученные</a>
            </div>
        </h1>
        
        <nav>
            <a href="index.html" class="nav-button">Главная</a>
            <a href="about.html" class="nav-button">Для админов</a>
            <a href="contact.html" class="nav-button">Контакты</a>
            <button id="messagesButton" class="nav-button">
                💬 Сообщения <span id="unreadMessagesCount" style="display: none;"></span>
            </button>
        </nav>
    </div>
    
    <div class="header-right">
        <div class="user-menu">
            <div class="user-avatar-container">
                <img id="userAvatar" class="user-avatar" src="http://10.100.6.123:3000/uploads/default-avatar.jpg" alt="Аватар">
            </div>
            <span class="user-name" id="name">Загрузка...</span>
            <div class="user-dropdown">
                <button id="profileButton">Профиль</button>
                <button id="adminButton" style="display: none;">Админка</button>
                <button id="logoutButton">Выход</button>
            </div>
        </div>
    </div>
</header>

<main>
    <section>
        <div id="available-achievements" class="links-container"></div>
    </section>
</main>

<!-- Модальное окно мессенджера -->
<div id="messengerModal">
    <div style="padding: 15px; border-bottom: 1px solid var(--darker-bg); display: flex; justify-content: space-between; align-items: center;">
        <h3 style="margin: 0;">Сообщения</h3>
        <div>
            <button id="showUsersButton" style="background-color: var(--primary-color); color: white; border: none; border-radius: var(--border-radius); padding: 5px 10px; margin-right: 10px; cursor: pointer;">Новый чат</button>
            <button id="closeMessengerButton" style="background: none; border: none; color: var(--text-color); cursor: pointer; font-size: 20px;">×</button>
        </div>
    </div>
    
    <div id="usersList" style="display: none;">
        <!-- Список пользователей будет здесь -->
    </div>
    
    <div id="conversationsList">
        <!-- Список диалогов будет здесь -->
    </div>
    
    <div id="chatContainer" style="display: none; flex-direction: column; height: 100%;">
        <div style="padding: 10px; border-bottom: 1px solid var(--darker-bg); display: flex; justify-content: space-between; align-items: center;">
            <div id="chatPartnerInfo" style="display: flex; align-items: center;">
                <img id="partnerAvatar" src="" class="author-avatar" style="margin-right: 10px;">
                <span id="partnerName"></span>
                <span id="unreadBadge" style="background-color: var(--primary-color); color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; margin-left: 10px;"></span>
            </div>
            <button id="backToConversations" style="background: none; border: none; color: var(--text-color); cursor: pointer;">← Назад</button>
        </div>
        
        <div id="messagesContainer" style="flex-grow: 1; overflow-y: auto; padding: 10px;">
            <!-- Сообщения будут здесь -->
        </div>
        
        <div style="padding: 10px; border-top: 1px solid var(--darker-bg);">
            <form id="messageForm" style="display: flex; gap: 10px;">
                <textarea id="messageInput" style="flex-grow: 1; padding: 10px; border-radius: var(--border-radius); 
                          border: 1px solid var(--darker-bg); background-color: var(--darker-bg); 
                          color: var(--text-color);" placeholder="Введите сообщение..." required></textarea>
                <button type="submit" style="padding: 10px; background-color: var(--primary-color); 
                        color: white; border: none; border-radius: var(--border-radius); cursor: pointer;">
                    Отправить
                </button>
            </form>
        </div>
    </div>
</div>

<!-- Кнопка открытия мессенджера -->
<button id="openMessengerButton">💬</button>

<script>
    // Проверка авторизации
    function checkAuthorization() {
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = 'login.html';
        }
    }

    // Функция для проверки роли пользователя
    function checkUserRole() {
        const token = localStorage.getItem('token');
        if (token) {
            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                return payload.role;
            } catch (e) {
                console.error('Ошибка декодирования токена:', e);
            }
        }
        return null;
    }

    // Функция для загрузки достижений
    async function loadAchievements() {
        try {
            const allAchievementsResponse = await fetch('http://10.100.6.123/api/available_achievements', {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            });
            
            if (!allAchievementsResponse.ok) {
                throw new Error('Ошибка при загрузке достижений');
            }
            
            const myAchievementsResponse = await fetch('http://10.100.6.123/api/my_achievements', {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            });
            
            if (!myAchievementsResponse.ok) {
                throw new Error('Ошибка при загрузке полученных достижений');
            }

            const allAchievements = await allAchievementsResponse.json();
            const myAchievements = await myAchievementsResponse.json();
            
            const achievementsDiv = document.getElementById('available-achievements');
            achievementsDiv.innerHTML = '';
            
            const myAchievementTitles = myAchievements.map(a => a.title);
            const availableAchievements = allAchievements.filter(a => !myAchievementTitles.includes(a.title));
            
            availableAchievements.forEach(achievement => {
                const achievementElement = document.createElement('div');
                achievementElement.className = 'achievement';
                achievementElement.innerHTML = `
                    <strong>${achievement.title}</strong>
                    <p>${achievement.description}</p>
                    <button onclick="unlockAchievement('${achievement.title}')">Получить</button>`;
                achievementsDiv.appendChild(achievementElement);
            });
        } catch (error) {
            console.error('Ошибка:', error);
            alert('Не удалось загрузить достижения');
        }
    }

    // Разблокировка достижения
    async function unlockAchievement(title) {
        try {
            const response = await fetch('http://10.100.6.123/api/achievements', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                },
                body: JSON.stringify({ title })
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Ошибка при получении достижения');
            }
            
            const data = await response.json();
            alert(data.message || 'Достижение успешно получено!');
            loadAchievements();
        } catch (error) {
            console.error('Ошибка:', error);
            alert(error.message || 'Не удалось получить достижение');
        }
    }

    async function checkAdminButton() {
        try {
            const response = await fetch('http://10.100.6.123/api/users/me/admin-button', { 
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            });

            if (!response.ok) throw new Error('Ошибка при проверке прав администратора');

            const data = await response.json();
            const adminButton = document.getElementById('adminButton');

            if (data.showAdminButton) {
                adminButton.style.display = 'block';
            } else {
                adminButton.style.display = 'none';
            }
        } catch (error) {
            console.error('Ошибка при проверке прав администратора:', error);
            document.getElementById('adminButton').style.display = 'none';
        }
    }

    // Загрузка информации о пользователе
    async function fetchUserInfo() {
        try {
            const response = await fetch('http://10.100.6.123/api/users/me', {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            });
            
            if (!response.ok) {
                throw new Error('Ошибка при загрузке информации о пользователе');
            }
            
            const data = await response.json();
            document.getElementById('name').textContent = data.name || 'Пользователь';
            
            const avatar = document.getElementById('userAvatar');
            if (data.profile_image) {
                avatar.src = `http://10.100.6.123:3000/uploads/${data.profile_image}?t=${Date.now()}`;
                avatar.onerror = () => {
                    avatar.src = 'http://10.100.6.123:3000/uploads/default-avatar.jpg';
                };
            }
            
            await checkAdminButton();
        } catch (error) {
            console.error('Ошибка:', error);
            document.getElementById('name').textContent = 'Ошибка загрузки';
            document.getElementById('userAvatar').src = 'http://10.100.6.123:3000/uploads/default-avatar.jpg';
        }
    }

    // Элементы мессенджера
    const token = localStorage.getItem('token');
    const messengerModal = document.getElementById('messengerModal');
    const openMessengerButton = document.getElementById('openMessengerButton');
    const closeMessengerButton = document.getElementById('closeMessengerButton');
    const messagesButton = document.getElementById('messagesButton');
    const conversationsList = document.getElementById('conversationsList');
    const usersList = document.getElementById('usersList');
    const chatContainer = document.getElementById('chatContainer');
    const messagesContainer = document.getElementById('messagesContainer');
    const messageInput = document.getElementById('messageInput');
    const messageForm = document.getElementById('messageForm');
    const backToConversations = document.getElementById('backToConversations');
    const partnerName = document.getElementById('partnerName');
    const partnerAvatar = document.getElementById('partnerAvatar');
    const unreadBadge = document.getElementById('unreadBadge');
    const unreadMessagesCount = document.getElementById('unreadMessagesCount');
    const showUsersButton = document.getElementById('showUsersButton');

    let currentChatPartnerId = null;
    let refreshInterval = null;

    // Функция для экранирования HTML
    function escapeHtml(text) {
        const map = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
        };
        return text.replace(/[&<>"']/g, m => map[m]);
    }

    // Открыть мессенджер
    function openMessenger() {
        messengerModal.style.display = 'flex';
        showConversationsList();
        startRefreshing();
    }

    // Закрыть мессенджер
    function closeMessenger() {
        messengerModal.style.display = 'none';
        stopRefreshing();
    }

    // Показать список пользователей
    function showUsersList() {
        conversationsList.style.display = 'none';
        chatContainer.style.display = 'none';
        usersList.style.display = 'block';
        loadUsers();
    }

    // Показать список диалогов
    function showConversationsList() {
        usersList.style.display = 'none';
        chatContainer.style.display = 'none';
        conversationsList.style.display = 'block';
        loadConversations();
    }

    // Назад к списку диалогов
    function backToConversationsList() {
        chatContainer.style.display = 'none';
        showConversationsList();
        currentChatPartnerId = null;
    }

    // Загрузка списка пользователей
    async function loadUsers() {
        try {
            const response = await fetch('http://10.100.6.123/api/users', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (!response.ok) throw new Error('Ошибка загрузки пользователей');
            
            const users = await response.json();
            usersList.innerHTML = '';
            
            if (users.length === 0) {
                usersList.innerHTML = '<div style="padding: 20px; text-align: center;">Нет пользователей</div>';
                return;
            }
            
            const currentUserId = JSON.parse(atob(token.split('.')[1])).id;
            const otherUsers = users.filter(user => user.id !== currentUserId);
            
            otherUsers.forEach(user => {
                const userEl = document.createElement('div');
                userEl.style.padding = '10px';
                userEl.style.borderBottom = '1px solid var(--darker-bg)';
                userEl.style.cursor = 'pointer';
                userEl.style.display = 'flex';
                userEl.style.alignItems = 'center';
                
                userEl.innerHTML = `
                    <img src="${user.profile_image ? 'http://10.100.6.123:3000/uploads/' + user.profile_image : 'http://10.100.6.123:3000/uploads/default-avatar.jpg'}" 
                         class="author-avatar" 
                         style="margin-right: 10px;"
                         onerror="this.src='http://10.100.6.123:3000/uploads/default-avatar.jpg'">
                    <div>
                        <div style="font-weight: bold;">${escapeHtml(user.name)} ${escapeHtml(user.last_name || '')}</div>
                        <div style="color: #aaa; font-size: 14px;">${escapeHtml(user.role || '')}</div>
                    </div>
                `;
                
                userEl.addEventListener('click', () => {
                    openChat(user.id, `${user.name} ${user.last_name || ''}`, user.profile_image);
                    showConversationsList();
                });
                
                usersList.appendChild(userEl);
            });
        } catch (error) {
            console.error('Ошибка:', error);
            usersList.innerHTML = `<div style="padding: 20px; color: var(--error-color);">${error.message}</div>`;
        }
    }

    // Отправка сообщения
    async function sendMessage() {
        const content = messageInput.value.trim();
        if (!content || !currentChatPartnerId) return;
        
        try {
            const response = await fetch('http://10.100.6.123/api/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    recipient_id: currentChatPartnerId,
                    content: content
                })
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Ошибка отправки сообщения');
            }
            
            messageInput.value = '';
            await loadMessages(currentChatPartnerId);
        } catch (error) {
            console.error('Ошибка:', error);
            alert('Не удалось отправить сообщение: ' + error.message);
        }
    }

    function startRefreshing() {
        refreshInterval = setInterval(() => {
            if (currentChatPartnerId) {
                loadMessages(currentChatPartnerId);
            } else {
                loadConversations();
            }
        }, 5000);
    }

    function stopRefreshing() {
        if (refreshInterval) {
            clearInterval(refreshInterval);
            refreshInterval = null;
        }
    }

    // Загрузка списка диалогов
    async function loadConversations() {
        try {
            const response = await fetch('http://10.100.6.123/api/conversations', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (!response.ok) throw new Error('Ошибка загрузки диалогов');
            
            const conversations = await response.json();
            conversationsList.innerHTML = '';
            
            if (conversations.length === 0) {
                conversationsList.innerHTML = '<div style="padding: 20px; text-align: center;">У вас пока нет сообщений</div>';
                return;
            }
            
            const totalUnread = conversations.reduce((sum, conv) => sum + (conv.unread_count || 0), 0);
            updateUnreadCount(totalUnread);
            
            conversations.forEach(conversation => {
                const conversationEl = document.createElement('div');
                conversationEl.style.padding = '10px';
                conversationEl.style.borderBottom = '1px solid var(--darker-bg)';
                conversationEl.style.cursor = 'pointer';
                conversationEl.style.display = 'flex';
                conversationEl.style.alignItems = 'center';
                conversationEl.style.justifyContent = 'space-between';
                
                conversationEl.innerHTML = `
                  <div style="display: flex; align-items: center;">
                     <img src="${conversation.profile_image ? 'http://10.100.6.123:3000/uploads/' + conversation.profile_image : 'http://10.100.6.123:3000/uploads/default-avatar.jpg'}" 
                          class="author-avatar" 
                          style="margin-right: 10px;"
                          onerror="this.src='http://10.100.6.123:3000/uploads/default-avatar.jpg'">
                 <div>
                 <div style="font-weight: bold;">${escapeHtml(conversation.name)} ${escapeHtml(conversation.last_name || '')}</div>
                 <div style="color: #aaa; font-size: 14px;">${escapeHtml((conversation.last_message || '').substring(0, 50))}</div>
            </div>
       </div>
       <div style="text-align: right;">
            <div style="font-size: 12px; color: #777;">${conversation.last_message_time ? new Date(conversation.last_message_time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : ''}</div>
                ${conversation.unread_count > 0 ? `<div style="background-color: var(--primary-color); color: white; border-radius: 50%; width: 20px; height: 20px; display: inline-flex; align-items: center; justify-content: center; font-size: 12px; margin-top: 5px;">${conversation.unread_count}</div>` : ''}
            </div>
            `;
                
                conversationEl.addEventListener('click', () => {
                    openChat(conversation.user_id, `${conversation.name} ${conversation.last_name || ''}`, conversation.profile_image);
                });
                
                conversationsList.appendChild(conversationEl);
            });
        } catch (error) {
            console.error('Ошибка:', error);
            conversationsList.innerHTML = `<div style="padding: 20px; color: var(--error-color);">${error.message}</div>`;
        }
    }

    // Обновление счетчика непрочитанных сообщений
    function updateUnreadCount(count) {
        if (count > 0) {
            unreadMessagesCount.textContent = count;
            unreadMessagesCount.style.display = 'inline';
        } else {
            unreadMessagesCount.style.display = 'none';
        }
    }

    // Открыть чат с пользователем
    function openChat(userId, userName, userAvatar) {
        currentChatPartnerId = userId;
        partnerName.textContent = userName;
        partnerAvatar.src = userAvatar ? 'http://10.100.6.123:3000/uploads/' + userAvatar : 'http://10.100.6.123:3000/uploads/default-avatar.jpg';
        partnerAvatar.onerror = () => { partnerAvatar.src = 'http://10.100.6.123:3000/uploads/default-avatar.jpg'; };
        
        conversationsList.style.display = 'none';
        usersList.style.display = 'none';
        chatContainer.style.display = 'flex';
        
        loadMessages(userId);
    }

    // Загрузить сообщения
    async function loadMessages(userId) {
         if (!userId || isNaN(userId)) {
             console.error('Invalid user ID:', userId);
             messagesContainer.innerHTML = '<div class="error">Выберите собеседника</div>';
               return;
           }       
         
           try {
            const response = await fetch(`http://10.100.6.123/api/messages/${userId}`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (!response.ok) throw new Error('Ошибка загрузки сообщений');
            
            const messages = await response.json();
            messagesContainer.innerHTML = '';
            
            if (messages.length === 0) {
                messagesContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: #777;">У вас пока нет сообщений</div>';
                return;
            }
            
            const currentUserId = JSON.parse(atob(token.split('.')[1])).id;
            
            messages.forEach(message => {
                const isCurrentUser = message.sender_id === currentUserId;
                const messageEl = document.createElement('div');
                messageEl.style.marginBottom = '10px';
                messageEl.style.display = 'flex';
                messageEl.style.flexDirection = isCurrentUser ? 'row-reverse' : 'row';
                
                messageEl.innerHTML = `
                    <div style="display: flex; align-items: flex-end; max-width: 80%;">
                        ${!isCurrentUser ? `<img src="${message.sender_avatar ? 'http://10.100.6.123:3000/uploads/' + message.sender_avatar : 'http://10.100.6.123:3000/uploads/default-avatar.jpg'}" 
                                              class="author-avatar" 
                                              style="margin-right: 10px;"
                                              onerror="this.src='http://10.100.6.123:3000/uploads/default-avatar.jpg'">` : ''}
                        <div style="background-color: ${isCurrentUser ? 'var(--primary-color)' : 'var(--darker-bg)'}; 
                                    color: white; 
                                    padding: 8px 12px; 
                                    border-radius: ${isCurrentUser ? '15px 15px 0 15px' : '15px 15px 15px 0'};
                                    word-wrap: break-word;">
                            <div>${escapeHtml(message.content)}</div>
                            <div style="font-size: 11px; text-align: right; color: ${isCurrentUser ? 'rgba(255,255,255,0.7)' : '#aaa'}; margin-top: 5px;">
                                ${new Date(message.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                            </div>
                        </div>
                    </div>
                `;
                
                messagesContainer.appendChild(messageEl);
            });
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            await markMessagesAsRead(userId);
            
        } catch (error) {
            console.error('Ошибка:', error);
            messagesContainer.innerHTML = `
                <div style="padding: 20px; color: var(--error-color);">
                    ${error.message}
                </div>
            `;
        }
    }

    // Пометить сообщения как прочитанные
    async function markMessagesAsRead(userId) {
        try {
            await fetch(`http://10.100.6.123/api/messages/${userId}/read`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
        } catch (error) {
            console.error('Ошибка при отметке сообщений как прочитанных:', error);
        }
    }

    // Проверка непрочитанных сообщений
    async function checkUnreadMessages() {
        try {
            const response = await fetch('http://10.100.6.123/api/conversations/unread', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                updateUnreadCount(data.total_unread || 0);
            }
        } catch (error) {
            console.error('Ошибка при проверке непрочитанных сообщений:', error);
        }
    }

    // Инициализация страницы
    document.addEventListener('DOMContentLoaded', () => {
        checkAuthorization();
        fetchUserInfo();
        loadAchievements();
        
        // Обработчики событий для кнопок
        document.getElementById('profileButton').addEventListener('click', () => {
            window.location.href = 'profile.html';
        });
        
        document.getElementById('adminButton').addEventListener('click', () => {
            window.location.href = 'admin.html';
        });
        
        document.getElementById('logoutButton').addEventListener('click', () => {
            localStorage.removeItem('token');
            window.location.href = 'login.html';
        });

        // Обработчики для мессенджера
        openMessengerButton.addEventListener('click', openMessenger);
        closeMessengerButton.addEventListener('click', closeMessenger);
        messagesButton.addEventListener('click', openMessenger);
        backToConversations.addEventListener('click', backToConversationsList);
        messageForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            await sendMessage();
        });
        showUsersButton.addEventListener('click', showUsersList);
        
        // Загружаем непрочитанные сообщения при загрузке страницы
        checkUnreadMessages();
    });

    document.addEventListener('DOMContentLoaded', () => {
        const avatar = document.getElementById('userAvatar');
        if (avatar) {
            avatar.onerror = function() {
                this.src = 'http://10.100.6.123:3000/uploads/default-avatar.jpg';
            };
        }
    });
</script>

</body>
</html>
